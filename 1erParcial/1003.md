# Ejercicio 1: Monitor de Sensores IoT en Sistema Domótico

**Escenario:** Un sistema de casa inteligente con múltiples sensores IoT (temperatura, humedad, movimiento, luz) registra lecturas cada minuto. Como técnico en robótica y automatización, necesitas analizar estos datos para identificar anomalías, generar reportes de estado y optimizar el sistema.

```bash
#!/bin/bash
# Script: crear_sensores_iot.sh
# Crea un archivo de lecturas simuladas de sensores IoT

echo "Creando archivo de lecturas de sensores IoT..."

cat > sensores.log << 'EOF'
S001|TEMPERATURA|22.5|CELSIUS|OK|SALA|2024-01-15-08:15:22
S002|HUMEDAD|45.0|PERCENT|OK|SALA|2024-01-15-08:15:23
S003|MOVIMIENTO|1|BOOLEAN|OK|SALA|2024-01-15-08:15:24
S004|LUZ|350|LUX|OK|SALA|2024-01-15-08:15:25
S001|TEMPERATURA|23.0|CELSIUS|OK|SALA|2024-01-15-08:16:22
S002|HUMEDAD|85.0|PERCENT|ALERT|SALA|2024-01-15-08:16:23
S005|TEMPERATURA|18.5|CELSIUS|OK|COCINA|2024-01-15-08:16:24
S006|HUMEDAD|60.0|PERCENT|OK|COCINA|2024-01-15-08:16:25
S007|MOVIMIENTO|0|BOOLEAN|OK|COCINA|2024-01-15-08:16:26
S008|LUZ|280|LUX|OK|COCINA|2024-01-15-08:16:27
S009|TEMPERATURA|20.0|CELSIUS|OK|DORMITORIO|2024-01-15-08:17:22
S010|HUMEDAD|50.0|PERCENT|OK|DORMITORIO|2024-01-15-08:17:23
S011|MOVIMIENTO|1|BOOLEAN|OK|DORMITORIO|2024-01-15-08:17:24
S012|LUZ|120|LUX|OK|DORMITORIO|2024-01-15-08:17:25
S001|TEMPERATURA|35.0|CELSIUS|ALERT|SALA|2024-01-15-08:18:22
S002|HUMEDAD|48.0|PERCENT|OK|SALA|2024-01-15-08:18:23
S003|MOVIMIENTO|0|BOOLEAN|OK|SALA|2024-01-15-08:18:24
S004|LUZ|400|LUX|OK|SALA|2024-01-15-08:18:25
S005|TEMPERATURA|19.0|CELSIUS|OK|COCINA|2024-01-15-08:19:22
S006|HUMEDAD|62.0|PERCENT|OK|COCINA|2024-01-15-08:19:23
S007|MOVIMIENTO|1|BOOLEAN|OK|COCINA|2024-01-15-08:19:24
S008|LUZ|290|LUX|OK|COCINA|2024-01-15-08:19:25
S013|TEMPERATURA|15.0|CELSIUS|OK|BAÑO|2024-01-15-08:20:22
S014|HUMEDAD|90.0|PERCENT|ALERT|BAÑO|2024-01-15-08:20:23
S015|MOVIMIENTO|1|BOOLEAN|OK|BAÑO|2024-01-15-08:20:24
S016|LUZ|180|LUX|OK|BAÑO|2024-01-15-08:20:25
S009|TEMPERATURA|21.0|CELSIUS|OK|DORMITORIO|2024-01-15-08:21:22
S010|HUMEDAD|52.0|PERCENT|OK|DORMITORIO|2024-01-15-08:21:23
S011|MOVIMIENTO|0|BOOLEAN|OK|DORMITORIO|2024-01-15-08:21:24
S012|LUZ|0|LUX|ERROR|DORMITORIO|2024-01-15-08:21:25
S001|TEMPERATURA|24.0|CELSIUS|OK|SALA|2024-01-15-08:22:22
S002|HUMEDAD|47.0|PERCENT|OK|SALA|2024-01-15-08:22:23
S003|MOVIMIENTO|1|BOOLEAN|OK|SALA|2024-01-15-08:22:24
S004|LUZ|0|LUX|ERROR|SALA|2024-01-15-08:22:25
S005|TEMPERATURA|40.0|CELSIUS|ALERT|COCINA|2024-01-15-08:23:22
S006|HUMEDAD|65.0|PERCENT|OK|COCINA|2024-01-15-08:23:23
S007|MOVIMIENTO|1|BOOLEAN|OK|COCINA|2024-01-15-08:23:24
S008|LUZ|300|LUX|OK|COCINA|2024-01-15-08:23:25
S013|TEMPERATURA|16.0|CELSIUS|OK|BAÑO|2024-01-15-08:24:22
S014|HUMEDAD|88.0|PERCENT|ALERT|BAÑO|2024-01-15-08:24:23
S015|MOVIMIENTO|0|BOOLEAN|OK|BAÑO|2024-01-15-08:24:24
S016|LUZ|200|LUX|OK|BAÑO|2024-01-15-08:24:25
EOF

echo "Archivo sensores.log creado con $(wc -l < sensores.log) lecturas"
echo ""
echo "=== VISTA PREVIA DE LECTURAS ==="
head -5 sensores.log
echo "..."
echo ""
echo "Formato: SENSOR_ID|TIPO|VALOR|UNIDAD|ESTADO|HABITACION|TIMESTAMP"
```

## Tareas:

1. **Crear directorio `analisis_sensores/`**

2. **Analizar actividad por habitación**
   - Contar cuántas lecturas hay por cada habitación
   - Ordenar por cantidad de lecturas (mayor a menor) `cut`, `sort`, `uniq` y `sort`
   - Guardar en `analisis_sensores/actividad_habitaciones.txt`
   - Ejemplo de salida:
     ```
     14 SALA
     12 COCINA
      8 DORMITORIO
      8 BAÑO
     ```

3. **Identificar todos los sensores con problemas (ALERT o ERROR)**
   - Filtrar líneas que contengan ALERT o ERROR
   - Extraer SENSOR_ID, TIPO, HABITACION y ESTADO `grep` y `cut`
   - Guardar en `analisis_sensores/sensores_problemas.txt`
   - Ejemplo de salida:
     ```
     S002|HUMEDAD|SALA|ALERT
     S001|TEMPERATURA|SALA|ALERT
     S014|HUMEDAD|BAÑO|ALERT
     S012|LUZ|DORMITORIO|ERROR
     S004|LUZ|SALA|ERROR
     S005|TEMPERATURA|COCINA|ALERT
     S014|HUMEDAD|BAÑO|ALERT
     ```

4. **Generar reporte de tipos de sensores más utilizados (Top 3)**
   - Extraer tipos de sensores y contar ocurrencias
   - Mostrar solo los 3 tipos con más lecturas `cut`, `sort`, `uniq`, `sort` y `head`
   - Guardar en `analisis_sensores/top3_sensores.txt`
   - Ejemplo de salida:
     ```
     11 TEMPERATURA
     11 MOVIMIENTO
     11 LUZ
     ```

5. **El directorio `analisis_sensores/` debe contener 3 archivos:**
   - `actividad_habitaciones.txt`
   - `sensores_problemas.txt`
   - `top3_sensores.txt`

----


# Ejercicio 2: Sistema de Control de Flota de Drones Autónomos

## Contexto
Una empresa de delivery con drones autónomos necesita un sistema robusto para gestionar su flota. El sistema debe controlar la batería, carga útil, rutas y mantenimiento preventivo, garantizando la seguridad de las operaciones aéreas.

## Requerimientos Específicos

### Clase `Drone`

- **Datos privados:**
  - ID del drone (único, formato: "DRN-XXX")
  - Nivel de batería actual (0-100%)
  - Capacidad máxima de carga en kilogramos
  - Estado operacional (Disponible, EnVuelo, Mantenimiento)
  - Horas de vuelo acumuladas
  - Paquete asignado actual (puede ser None)

- **Validaciones encapsuladas:**
  - El drone no puede despegar si la batería es menor al 30%
  - La batería nunca puede ser negativa ni mayor a 100%
  - No puede cargar un paquete si ya tiene uno asignado
  - El peso del paquete no puede exceder la capacidad máxima de carga
  - Debe entrar a mantenimiento obligatorio cada 50 horas de vuelo
  - No puede volar si está en estado Mantenimiento

- **Métodos públicos:**
  - `despegar()` - Retorna True si puede despegar, False si no cumple condiciones
  - `aterrizar()` - Finaliza el vuelo y actualiza horas de vuelo (+0.5 horas)
  - `cargar_bateria(porcentaje)` - Aumenta la batería del drone
  - `asignar_paquete(paquete)` - Retorna True si puede asignar, False si no es posible
  - `entregar_paquete()` - Marca la entrega y libera el paquete asignado
  - `requiere_mantenimiento()` - Retorna True si necesita mantenimiento
  - `enviar_a_mantenimiento()` - Cambia el estado a Mantenimiento y resetea horas
  - `obtener_info()` - Retorna diccionario con info básica (ID, estado, batería)

### Clase `Paquete`

- **Datos privados:**
  - ID del paquete (único, formato: "PKG-XXXXX")
  - Peso en kilogramos
  - Dirección de entrega
  - Prioridad (1=Baja, 2=Normal, 3=Alta, 4=Urgente)
  - Estado de entrega (Pendiente, Asignado, Entregado, Fallido)
  - Intentos de entrega realizados

- **Validaciones encapsuladas:**
  - El peso debe estar entre 0.1 kg y 5.0 kg
  - No se puede asignar un paquete si ya está asignado o entregado
  - El número máximo de intentos de entrega es 3
  - Si se alcanzan 3 intentos fallidos, el estado cambia automáticamente a Fallido

- **Métodos públicos:**
  - `puede_ser_asignado()` - Retorna True si está disponible para asignación
  - `asignar()` - Cambia estado a Asignado, retorna True si tiene éxito
  - `marcar_entregado()` - Cambia estado a Entregado, retorna True si tiene éxito
  - `registrar_intento_fallido()` - Incrementa intentos y verifica límite
  - `obtener_info()` - Retorna diccionario con info del paquete

### Clase `EstacionBase`

- **Datos privados:**
  - ID de la estación (formato: "BASE-XX")
  - Lista de drones registrados (máximo 5 drones)
  - Cola de paquetes pendientes (lista ordenada por prioridad)
  - Contador de entregas completadas

- **Validaciones encapsuladas:**
  - No se pueden registrar más de 5 drones en la estación
  - Solo pueden estar en vuelo simultáneamente hasta 3 drones
  - No se puede asignar un paquete a un drone no disponible
  - No se pueden agregar paquetes con peso inválido

- **Métodos públicos:**
  - `registrar_drone(drone)` - Retorna True si puede registrar, False si está lleno
  - `agregar_paquete(paquete)` - Retorna True si agrega correctamente
  - `asignar_paquete_automatico()` - Asigna el próximo paquete al primer drone disponible, retorna True si tiene éxito
  - `iniciar_entrega(drone_id)` - Despega drone con su paquete asignado, retorna True si tiene éxito
  - `completar_entrega(drone_id)` - Procesa entrega exitosa, retorna True si tiene éxito  

## Casos de Prueba Específicos

```python
# main.py - Archivo de pruebas obligatorio

from drone import Drone
from paquete import Paquete
from estacion_base import EstacionBase

def main():
    print("=== SISTEMA DE CONTROL DE FLOTA DE DRONES ===\n")
    
    # Crear estación base
    base = EstacionBase("BASE-01")
    print("✓ Estación base creada\n")
    
    # Crear drones
    drone1 = Drone("DRN-001", capacidad_carga=3.5)
    drone2 = Drone("DRN-002", capacidad_carga=5.0)
    drone3 = Drone("DRN-003", capacidad_carga=2.0)
    print("✓ Drones creados")
    
    # Registrar drones en la base
    if base.registrar_drone(drone1):
        print("✓ Drone 1 registrado")
    if base.registrar_drone(drone2):
        print("✓ Drone 2 registrado")
    if base.registrar_drone(drone3):
        print("✓ Drone 3 registrado")
    print()
    
    # Crear paquetes
    paquete1 = Paquete("PKG-00001", 2.5, "Av. Banzer 123", 3)  # Alta
    paquete2 = Paquete("PKG-00002", 1.2, "Calle 24 de Septiembre", 4)  # Urgente
    paquete3 = Paquete("PKG-00003", 4.8, "Radial 10 esq. 4to Anillo", 2)  # Normal
    paquete4 = Paquete("PKG-00004", 0.5, "Plaza 24 de Septiembre", 1)  # Baja
    print("✓ Paquetes creados\n")
    
    # Agregar paquetes a la cola
    base.agregar_paquete(paquete1)
    base.agregar_paquete(paquete2)
    base.agregar_paquete(paquete3)
    base.agregar_paquete(paquete4)
    print("✓ Paquetes agregados a la cola\n")
    
    # Cargar batería de los drones
    drone1.cargar_bateria(100)
    drone2.cargar_bateria(100)
    drone3.cargar_bateria(25)  # Batería insuficiente
    print("✓ Drones cargados\n")
    
    # Asignación automática - debe asignar paquete urgente primero
    print("--- Asignación Automática de Paquetes ---")
    if base.asignar_paquete_automatico():
        print("✓ Paquete asignado (debería ser PKG-00002 - Urgente)")
    if base.asignar_paquete_automatico():
        print("✓ Paquete asignado (debería ser PKG-00001 - Alta)")
    if base.asignar_paquete_automatico():
        print("✓ Paquete asignado (debería ser PKG-00003 - Normal)")
    print()
    
    # Iniciar entregas
    print("--- Iniciando Entregas ---")
    if base.iniciar_entrega("DRN-001"):
        print("✓ Entrega iniciada con DRN-001")
    else:
        print("✗ No se pudo iniciar entrega con DRN-001")
    
    if base.iniciar_entrega("DRN-002"):
        print("✓ Entrega iniciada con DRN-002")
    else:
        print("✗ No se pudo iniciar entrega con DRN-002")
    print()
    
    # Intentar despegar drone con batería baja
    print("--- Prueba: Despegar con batería baja ---")
    if base.iniciar_entrega("DRN-003"):
        print("✗ ERROR: No debería permitir despegar con batería baja")
    else:
        print("✓ Correctamente bloqueado: batería insuficiente\n")
    
    # Mostrar info de drones
    print("--- Estado de Drones ---")
    info1 = drone1.obtener_info()
    print(f"Drone: {info1['id']}, Estado: {info1['estado']}, Batería: {info1['bateria']}%")
    info2 = drone2.obtener_info()
    print(f"Drone: {info2['id']}, Estado: {info2['estado']}, Batería: {info2['bateria']}%")
    info3 = drone3.obtener_info()
    print(f"Drone: {info3['id']}, Estado: {info3['estado']}, Batería: {info3['bateria']}%")
    print()
    
    # Completar entregas
    print("--- Completando Entregas ---")
    if base.completar_entrega("DRN-001"):
        print("✓ Entrega completada por DRN-001")
    if base.completar_entrega("DRN-002"):
        print("✓ Entrega completada por DRN-002")
    print()
    
    # Simular desgaste para mantenimiento
    print("--- Simulando Desgaste (51 horas de vuelo) ---")
    for i in range(102):  # Simular 102 vuelos de 0.5 horas = 51 horas
        drone1.aterrizar()
    
    if drone1.requiere_mantenimiento():
        print("✓ DRN-001 requiere mantenimiento")
        drone1.enviar_a_mantenimiento()
        print("✓ DRN-001 enviado a mantenimiento")
    print()
    
    # Intentar asignar paquete a drone en mantenimiento
    print("--- Prueba: Asignar paquete a drone en mantenimiento ---")
    if paquete4.puede_ser_asignado():
        if drone1.asignar_paquete(paquete4):
            print("✗ ERROR: No debería permitir asignar paquete a drone en mantenimiento")
        else:
            print("✓ Correctamente bloqueado: drone en mantenimiento\n")
    
    # Intentar crear paquete con peso excesivo
    print("--- Prueba: Crear paquete con peso inválido ---")
    paquete_pesado = Paquete("PKG-00005", 6.0, "Dirección X", 2)
    if base.agregar_paquete(paquete_pesado):
        print("✗ ERROR: No debería permitir paquetes mayores a 5kg")
    else:
        print("✓ Correctamente bloqueado: peso excede límite\n")
    
    # Intentar paquete con peso muy bajo
    print("--- Prueba: Crear paquete con peso muy bajo ---")
    paquete_liviano = Paquete("PKG-00006", 0.05, "Dirección Y", 2)
    if base.agregar_paquete(paquete_liviano):
        print("✗ ERROR: No debería permitir paquetes menores a 0.1kg")
    else:
        print("✓ Correctamente bloqueado: peso muy bajo\n")
    
    # Simular intentos fallidos
    print("--- Prueba: Intentos de entrega fallidos ---")
    paquete_dificil = Paquete("PKG-00007", 1.0, "Zona Inaccesible", 2)
    base.agregar_paquete(paquete_dificil)
    
    paquete_dificil.registrar_intento_fallido()
    print(f"Intento 1 fallido")
    paquete_dificil.registrar_intento_fallido()
    print(f"Intento 2 fallido")
    paquete_dificil.registrar_intento_fallido()
    print(f"Intento 3 fallido")
    
    info_paquete = paquete_dificil.obtener_info()
    print(f"✓ Estado del paquete: {info_paquete['estado']}\n")
    
    # Intentar marcar como entregado un paquete fallido
    print("--- Prueba: Entregar paquete con estado Fallido ---")
    if paquete_dificil.marcar_entregado():
        print("✗ ERROR: No debería permitir marcar como entregado un paquete fallido")
    else:
        print("✓ Correctamente bloqueado: paquete en estado Fallido\n")
    
    # Estadísticas finales
    # print("--- Estadísticas de la Estación ---")
    # stats = base.obtener_estadisticas()
    # print(f"Total de drones: {stats['total_drones']}")
    # print(f"Drones disponibles: {stats['drones_disponibles']}")
    # print(f"Drones en vuelo: {stats['drones_en_vuelo']}")
    # print(f"Entregas completadas: {stats['entregas_completadas']}")
    # print(f"Paquetes pendientes: {stats['paquetes_pendientes']}")
    
    print("\n=== FIN DE PRUEBAS ===")

if __name__ == "__main__":
    main()
```

## Salida Esperada del Programa

```
=== SISTEMA DE CONTROL DE FLOTA DE DRONES ===

✓ Estación base creada

✓ Drones creados
✓ Drone 1 registrado
✓ Drone 2 registrado
✓ Drone 3 registrado

✓ Paquetes creados

✓ Paquetes agregados a la cola

✓ Drones cargados

--- Asignación Automática de Paquetes ---
✓ Paquete asignado (debería ser PKG-00002 - Urgente)
✓ Paquete asignado (debería ser PKG-00001 - Alta)
✓ Paquete asignado (debería ser PKG-00003 - Normal)

--- Iniciando Entregas ---
✓ Entrega iniciada con DRN-001
✓ Entrega iniciada con DRN-002

--- Prueba: Despegar con batería baja ---
✓ Correctamente bloqueado: batería insuficiente

--- Estado de Drones ---
Drone: DRN-001, Estado: EnVuelo, Batería: 100%
Drone: DRN-002, Estado: EnVuelo, Batería: 100%
Drone: DRN-003, Estado: Disponible, Batería: 25%

--- Completando Entregas ---
✓ Entrega completada por DRN-001
✓ Entrega completada por DRN-002

--- Simulando Desgaste (51 horas de vuelo) ---
✓ DRN-001 requiere mantenimiento
✓ DRN-001 enviado a mantenimiento

--- Prueba: Asignar paquete a drone en mantenimiento ---
✓ Correctamente bloqueado: drone en mantenimiento

--- Prueba: Crear paquete con peso inválido ---
✓ Correctamente bloqueado: peso excede límite

--- Prueba: Crear paquete con peso muy bajo ---
✓ Correctamente bloqueado: peso muy bajo

--- Prueba: Intentos de entrega fallidos ---
Intento 1 fallido
Intento 2 fallido
Intento 3 fallido
✓ Estado del paquete: Fallido

--- Prueba: Entregar paquete con estado Fallido ---
✓ Correctamente bloqueado: paquete en estado Fallido

```

## Entregables

1. `drone.py` - Implementación completa de la clase Drone
2. `paquete.py` - Implementación completa de la clase Paquete
3. `estacion_base.py` - Implementación completa de la clase EstacionBase
4. `main.py` - Archivo de pruebas proporcionado (no modificar)

**Nota:** El programa debe ejecutarse completamente y producir una salida similar a la esperada. Todos los checks deben pasar correctamente.